defmodule TSVars do
  use Fsm, initial_state: :nodata, initial_data: nil

	defstate nodata do
	end

	defstate disturbance do
	end

	defstate delay do
	end
	
	# Global event handler
	defevent update(values) do
		
			case(values.disturbance) do
				"yes"	-> next_state(:disturbance, nil)
				"no"	-> 
					case(values.congestion) do
						"none"	->
							next_state(:delay, values)
						"low"		->
							newValues = %{values | :delay => Map.get(values, :delay) * 2}
							next_state(:delay, newValues)
						"high"	->
							newValues = %{values | :delay => Map.get(values, :delay) * 3}
							next_state(:delay, values)
						_				->
							next_state(:delay, values)	
					end
				_			-> next_state(:delay, values)	
			end          

		end
end
