# Module to test API

defmodule APITest do
  use ExUnit.Case, async: true
  use Maru.Test, for: API

  setup do
    conn=build_conn()|>put_req_header("content-type", "application/json")
    |>put_plug(Plug.Parsers, parsers: [:json], pass: ["*/*"], json_decoder: Poison)
    {:ok, %{conn: conn}}
  end

  test "Return welcome message" do
    assert "Welcome to TransportScheduler API\n" == get("/api")|>text_response
  end

  test "Returns schedule", %{conn: conn} do
    get("/api")
    schedule1="[{\"vehicleID\":\"16590\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":1200,\"arrival_time\":2700},{\"vehicleID\":\"16536\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":3600,\"arrival_time\":5880},{\"vehicleID\":\"16535\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":5700,\"arrival_time\":7680},{\"vehicleID\":\"12781\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":10020,\"arrival_time\":11760},{\"vehicleID\":\"16589\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":12900,\"arrival_time\":14580},{\"vehicleID\":\"16210\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":15300,\"arrival_time\":17040},{\"vehicleID\":\"16506\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":15300,\"arrival_time\":17040},{\"vehicleID\":\"16508\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":15300,\"arrival_time\":17040},{\"vehicleID\":\"17311\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":15300,\"arrival_time\":17040},{\"vehicleID\":\"17313\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":15300,\"arrival_time\":17040},{\"vehicleID\":\"17310\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":11,\"dept_time\":15300,\"arrival_time\":18420},{\"vehicleID\":\"17301\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":18900,\"arrival_time\":20820},{\"vehicleID\":\"12726\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":27000,\"arrival_time\":28680},{\"vehicleID\":\"12777\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":30060,\"arrival_time\":31800},{\"vehicleID\":\"12778\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":38400,\"arrival_time\":40140},{\"vehicleID\":\"12079\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":41520,\"arrival_time\":43140},{\"vehicleID\":\"11006\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":46200,\"arrival_time\":48240},{\"vehicleID\":\"11022\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":46200,\"arrival_time\":48240},{\"vehicleID\":\"11036\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":46200,\"arrival_time\":48240},{\"vehicleID\":\"11005\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":51840,\"arrival_time\":53280},{\"vehicleID\":\"11021\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":51840,\"arrival_time\":53280},{\"vehicleID\":\"11035\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":51840,\"arrival_time\":53280},{\"vehicleID\":\"12080\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":55800,\"arrival_time\":57120},{\"vehicleID\":\"12725\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":68400,\"arrival_time\":70500},{\"vehicleID\":\"16209\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":70080,\"arrival_time\":72300},{\"vehicleID\":\"16505\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":70080,\"arrival_time\":72300},{\"vehicleID\":\"16507\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":70080,\"arrival_time\":72300},{\"vehicleID\":\"17309\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":8,\"dept_time\":75000,\"arrival_time\":77040},{\"vehicleID\":\"12782\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":79320,\"arrival_time\":81180},{\"vehicleID\":\"17314\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":10,\"dept_time\":79320,\"arrival_time\":81180},{\"vehicleID\":\"17312\",\"src_station\":9,\"mode_of_transport\":\"train\",\"dst_station\":11,\"dept_time\":79320,\"arrival_time\":82200}]"
    assert schedule1==conn|>get("/api/station/schedule?station_code=9&date=11-2-2017")|>text_response
    schedule2="[{\"vehicleID\":\"G8-376_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":24600,\"arrival_time\":28200},{\"vehicleID\":\"866_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":25800,\"arrival_time\":29100},{\"vehicleID\":\"9W_480_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":26100,\"arrival_time\":30300},{\"vehicleID\":\"4582322\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2137,\"dept_time\":27900,\"arrival_time\":30600},{\"vehicleID\":\"G8-374_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":28800,\"arrival_time\":32700},{\"vehicleID\":\"866_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":25800,\"arrival_time\":40200},{\"vehicleID\":\"866_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2162,\"dept_time\":25800,\"arrival_time\":48600},{\"vehicleID\":\"SG_247_B737-900\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":48600,\"arrival_time\":52800},{\"vehicleID\":\"518_A319\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2159,\"dept_time\":49500,\"arrival_time\":52800},{\"vehicleID\":\"9W_476_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":49200,\"arrival_time\":53100},{\"vehicleID\":\"SG_246_B737-800\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":49200,\"arrival_time\":53400},{\"vehicleID\":\"6E_438_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":49800,\"arrival_time\":53700},{\"vehicleID\":\"6E_343_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":52200,\"arrival_time\":56400},{\"vehicleID\":\"SG_1072_Q-400\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2149,\"dept_time\":51300,\"arrival_time\":56700},{\"vehicleID\":\"9W_627_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":52800,\"arrival_time\":56700},{\"vehicleID\":\"4715348\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2137,\"dept_time\":54060,\"arrival_time\":56760},{\"vehicleID\":\"9W_2352_ATR-72\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":51000,\"arrival_time\":57000},{\"vehicleID\":\"9W_499_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":53700,\"arrival_time\":57600},{\"vehicleID\":\"660_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":54000,\"arrival_time\":58200},{\"vehicleID\":\"6E_418_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":54300,\"arrival_time\":58200},{\"vehicleID\":\"4749945\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":40500,\"arrival_time\":58500},{\"vehicleID\":\"518_A319\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2149,\"dept_time\":49500,\"arrival_time\":59100},{\"vehicleID\":\"SG_254_B737-900\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":50400,\"arrival_time\":59400},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2137,\"dept_time\":53400,\"arrival_time\":59400},{\"vehicleID\":\"9W_496_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":57300,\"arrival_time\":61200},{\"vehicleID\":\"9W_474_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":58800,\"arrival_time\":62700},{\"vehicleID\":\"4598135\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":27900,\"arrival_time\":63000},{\"vehicleID\":\"G8-372_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":59400,\"arrival_time\":63600},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2137,\"dept_time\":58200,\"arrival_time\":64200},{\"vehicleID\":\"662_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":60000,\"arrival_time\":64200},{\"vehicleID\":\"6E_332_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":55800,\"arrival_time\":64500},{\"vehicleID\":\"SG_804_B737-900\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":60900,\"arrival_time\":64800},{\"vehicleID\":\"6E_438_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":779,\"dept_time\":49800,\"arrival_time\":65100},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":53400,\"arrival_time\":66600},{\"vehicleID\":\"9W_496_B7373-80\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2143,\"dept_time\":57300,\"arrival_time\":66600},{\"vehicleID\":\"SG_138_B737-800\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2137,\"dept_time\":60600,\"arrival_time\":66600},{\"vehicleID\":\"6E_192_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2155,\"dept_time\":62400,\"arrival_time\":66600},{\"vehicleID\":\"SG_1012_Q-400\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2143,\"dept_time\":60000,\"arrival_time\":67500},{\"vehicleID\":\"6E_343_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2152,\"dept_time\":52200,\"arrival_time\":67800},{\"vehicleID\":\"4749946\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":50400,\"arrival_time\":68400},{\"vehicleID\":\"660_A321\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":54000,\"arrival_time\":68400},{\"vehicleID\":\"4749953\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":54240,\"arrival_time\":71100},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":58200,\"arrival_time\":71100},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":156,\"dept_time\":53400,\"arrival_time\":72600},{\"vehicleID\":\"SG_256_B737-900\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":64200,\"arrival_time\":72600},{\"vehicleID\":\"6E_336_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":63900,\"arrival_time\":72900},{\"vehicleID\":\"4224310\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":30600,\"arrival_time\":73800},{\"vehicleID\":\"4224906\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":34200,\"arrival_time\":73800},{\"vehicleID\":\"4749947\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":55800,\"arrival_time\":73800},{\"vehicleID\":\"SG_1012_Q-400\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2149,\"dept_time\":60000,\"arrival_time\":74100},{\"vehicleID\":\"6E_162_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":156,\"dept_time\":58200,\"arrival_time\":77100},{\"vehicleID\":\"SG_138_B737-800\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":60600,\"arrival_time\":77100},{\"vehicleID\":\"4233363\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":34200,\"arrival_time\":77400},{\"vehicleID\":\"4233416\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":37800,\"arrival_time\":77400},{\"vehicleID\":\"SG_804_B737-900\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2152,\"dept_time\":60900,\"arrival_time\":77700},{\"vehicleID\":\"6E_192_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":785,\"dept_time\":62400,\"arrival_time\":78000},{\"vehicleID\":\"G8-246_A320\",\"src_station\":2148,\"mode_of_transport\":\"flight\",\"dst_station\":2141,\"dept_time\":74700,\"arrival_time\":78300},{\"vehicleID\":\"4749948\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":62100,\"arrival_time\":80100},{\"vehicleID\":\"4586984\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":27900,\"arrival_time\":81000},{\"vehicleID\":\"4715516\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":34200,\"arrival_time\":81000},{\"vehicleID\":\"4224303\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":30600,\"arrival_time\":82800},{\"vehicleID\":\"4224903\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":34200,\"arrival_time\":82800},{\"vehicleID\":\"4749949\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":66600,\"arrival_time\":84600},{\"vehicleID\":\"4731189\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":63060,\"arrival_time\":85560},{\"vehicleID\":\"4591604\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":68400,\"arrival_time\":85920},{\"vehicleID\":\"4768145\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":68340,\"arrival_time\":85980},{\"vehicleID\":\"4667587\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":68460,\"arrival_time\":85980},{\"vehicleID\":\"4781868\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":63000,\"arrival_time\":86100},{\"vehicleID\":\"4407246\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":64800,\"arrival_time\":86100},{\"vehicleID\":\"4407269\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":65100,\"arrival_time\":86100},{\"vehicleID\":\"4674646\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":67560,\"arrival_time\":86100},{\"vehicleID\":\"4784984\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":68460,\"arrival_time\":86160},{\"vehicleID\":\"4733467\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2154,\"dept_time\":55920,\"arrival_time\":86340},{\"vehicleID\":\"4233338\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":34200,\"arrival_time\":88200},{\"vehicleID\":\"4233380\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":37800,\"arrival_time\":88200},{\"vehicleID\":\"4715722\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":34200,\"arrival_time\":90000},{\"vehicleID\":\"4715693\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":34200,\"arrival_time\":94500},{\"vehicleID\":\"4749950\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":73800,\"arrival_time\":94500},{\"vehicleID\":\"4646608\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":54060,\"arrival_time\":95340},{\"vehicleID\":\"4749952\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":72000,\"arrival_time\":96000},{\"vehicleID\":\"4749951\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":7,\"dept_time\":75600,\"arrival_time\":97200},{\"vehicleID\":\"4245139\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":61200,\"arrival_time\":100800},{\"vehicleID\":\"4245800\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":61200,\"arrival_time\":100800},{\"vehicleID\":\"4598130\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":67500,\"arrival_time\":100800},{\"vehicleID\":\"4603799\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":63120,\"arrival_time\":100920},{\"vehicleID\":\"4670117\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":61200,\"arrival_time\":104400},{\"vehicleID\":\"4670118\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63000,\"arrival_time\":104400},{\"vehicleID\":\"4783517\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":63000,\"arrival_time\":104400},{\"vehicleID\":\"4719896\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63060,\"arrival_time\":104700},{\"vehicleID\":\"4603798\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63120,\"arrival_time\":106020},{\"vehicleID\":\"4598137\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":62880,\"arrival_time\":106080},{\"vehicleID\":\"4583262\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":360,\"dept_time\":27900,\"arrival_time\":106200},{\"vehicleID\":\"4598140\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":106200},{\"vehicleID\":\"4694961\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":106200},{\"vehicleID\":\"4758561\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2154,\"dept_time\":71100,\"arrival_time\":106200},{\"vehicleID\":\"4758573\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2154,\"dept_time\":73200,\"arrival_time\":106200},{\"vehicleID\":\"4646609\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":54060,\"arrival_time\":106260},{\"vehicleID\":\"4729193\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":63300,\"arrival_time\":106500},{\"vehicleID\":\"4647800\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":66660,\"arrival_time\":107160},{\"vehicleID\":\"4105822\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":61200,\"arrival_time\":108000},{\"vehicleID\":\"4257337\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":61200,\"arrival_time\":108000},{\"vehicleID\":\"4713086\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63000,\"arrival_time\":108000},{\"vehicleID\":\"4708701\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":65700,\"arrival_time\":108000},{\"vehicleID\":\"4404737\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":108000},{\"vehicleID\":\"4405081\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":108000},{\"vehicleID\":\"4669442\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":108000},{\"vehicleID\":\"4362351\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":108000},{\"vehicleID\":\"4407022\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":108000},{\"vehicleID\":\"4602204\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":108000},{\"vehicleID\":\"4450602\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":72000,\"arrival_time\":108000},{\"vehicleID\":\"4245173\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":61200,\"arrival_time\":108180},{\"vehicleID\":\"4245798\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":61200,\"arrival_time\":108180},{\"vehicleID\":\"4637502\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63300,\"arrival_time\":108300},{\"vehicleID\":\"4591373\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2149,\"dept_time\":60300,\"arrival_time\":108900},{\"vehicleID\":\"4591329\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":62880,\"arrival_time\":109320},{\"vehicleID\":\"4840866\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2221,\"dept_time\":27900,\"arrival_time\":109800},{\"vehicleID\":\"4734538\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2156,\"dept_time\":55920,\"arrival_time\":109800},{\"vehicleID\":\"4252938\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2149,\"dept_time\":61200,\"arrival_time\":109800},{\"vehicleID\":\"4065505\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63000,\"arrival_time\":109800},{\"vehicleID\":\"4104751\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63000,\"arrival_time\":109800},{\"vehicleID\":\"4783514\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63000,\"arrival_time\":109800},{\"vehicleID\":\"4385001\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":63000,\"arrival_time\":109800},{\"vehicleID\":\"4264752\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64800,\"arrival_time\":109800},{\"vehicleID\":\"4264763\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64800,\"arrival_time\":109800},{\"vehicleID\":\"4325507\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64800,\"arrival_time\":109800},{\"vehicleID\":\"4096285\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":64800,\"arrival_time\":109800},{\"vehicleID\":\"4326784\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":65100,\"arrival_time\":109800},{\"vehicleID\":\"4336651\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":70200,\"arrival_time\":109800},{\"vehicleID\":\"4336689\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":70200,\"arrival_time\":109800},{\"vehicleID\":\"4624036\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64860,\"arrival_time\":110160},{\"vehicleID\":\"4743382\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":69300,\"arrival_time\":110700},{\"vehicleID\":\"4816723\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64800,\"arrival_time\":111600},{\"vehicleID\":\"4611090\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":64800,\"arrival_time\":111600},{\"vehicleID\":\"4104929\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":66600,\"arrival_time\":111600},{\"vehicleID\":\"4661665\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":66600,\"arrival_time\":111600},{\"vehicleID\":\"4224311\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":111600},{\"vehicleID\":\"4669443\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":70200,\"arrival_time\":111600},{\"vehicleID\":\"4224907\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":72000,\"arrival_time\":111600},{\"vehicleID\":\"4378973\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":72000,\"arrival_time\":111600},{\"vehicleID\":\"4379000\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":72000,\"arrival_time\":111600},{\"vehicleID\":\"4591372\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2149,\"dept_time\":58500,\"arrival_time\":112500},{\"vehicleID\":\"4580145\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":61200,\"arrival_time\":113400},{\"vehicleID\":\"4781839\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63000,\"arrival_time\":113400},{\"vehicleID\":\"4224304\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63000,\"arrival_time\":113400},{\"vehicleID\":\"4413067\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63000,\"arrival_time\":113400},{\"vehicleID\":\"4770266\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":64800,\"arrival_time\":113400},{\"vehicleID\":\"4770268\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":65100,\"arrival_time\":113400},{\"vehicleID\":\"4770632\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":65400,\"arrival_time\":113400},{\"vehicleID\":\"4597817\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":66600,\"arrival_time\":113400},{\"vehicleID\":\"4597827\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":66600,\"arrival_time\":113400},{\"vehicleID\":\"4227679\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":113400},{\"vehicleID\":\"4415382\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":113400},{\"vehicleID\":\"4751343\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":66600,\"arrival_time\":113400},{\"vehicleID\":\"4367763\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":70200,\"arrival_time\":113400},{\"vehicleID\":\"4233912\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":70200,\"arrival_time\":113400},{\"vehicleID\":\"4666613\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":70200,\"arrival_time\":113400},{\"vehicleID\":\"4754753\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":70200,\"arrival_time\":113400},{\"vehicleID\":\"4531630\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":71100,\"arrival_time\":113400},{\"vehicleID\":\"4531549\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":71400,\"arrival_time\":113400},{\"vehicleID\":\"4367887\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":73800,\"arrival_time\":113400},{\"vehicleID\":\"4546881\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":73800,\"arrival_time\":113400},{\"vehicleID\":\"4546920\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":73800,\"arrival_time\":113400},{\"vehicleID\":\"4666622\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":73800,\"arrival_time\":113400},{\"vehicleID\":\"4670119\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":68400,\"arrival_time\":113700},{\"vehicleID\":\"4674497\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":67560,\"arrival_time\":114360},{\"vehicleID\":\"4734539\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2156,\"dept_time\":61200,\"arrival_time\":115200},{\"vehicleID\":\"4105220\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":64800,\"arrival_time\":115200},{\"vehicleID\":\"4448102\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":115200},{\"vehicleID\":\"4475769\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":68400,\"arrival_time\":115200},{\"vehicleID\":\"4448137\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":72000,\"arrival_time\":115200},{\"vehicleID\":\"4476838\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":72000,\"arrival_time\":115200},{\"vehicleID\":\"4731198\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":63060,\"arrival_time\":115260},{\"vehicleID\":\"4591333\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":115440},{\"vehicleID\":\"4624037\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":68400,\"arrival_time\":116700},{\"vehicleID\":\"4436614\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":62100,\"arrival_time\":117000},{\"vehicleID\":\"4597984\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":117000},{\"vehicleID\":\"4448103\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":70200,\"arrival_time\":117000},{\"vehicleID\":\"4597976\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":70200,\"arrival_time\":117000},{\"vehicleID\":\"4448138\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":73800,\"arrival_time\":117000},{\"vehicleID\":\"4224313\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":73800,\"arrival_time\":117000},{\"vehicleID\":\"4224909\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2159,\"dept_time\":77400,\"arrival_time\":117000},{\"vehicleID\":\"4647917\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":66660,\"arrival_time\":117060},{\"vehicleID\":\"4342393\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":117060},{\"vehicleID\":\"4667252\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2141,\"dept_time\":68460,\"arrival_time\":117060},{\"vehicleID\":\"4715747\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2150,\"dept_time\":34200,\"arrival_time\":118800},{\"vehicleID\":\"4095921\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":64800,\"arrival_time\":118800},{\"vehicleID\":\"4224299\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":68400,\"arrival_time\":118800},{\"vehicleID\":\"4224305\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":118800},{\"vehicleID\":\"4224899\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":72000,\"arrival_time\":118800},{\"vehicleID\":\"4227680\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":72000,\"arrival_time\":118800},{\"vehicleID\":\"4690150\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":63000,\"arrival_time\":120600},{\"vehicleID\":\"4690149\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":120600},{\"vehicleID\":\"4735066\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":66600,\"arrival_time\":120600},{\"vehicleID\":\"4228935\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":70200,\"arrival_time\":120600},{\"vehicleID\":\"4228941\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":73800,\"arrival_time\":120600},{\"vehicleID\":\"4591976\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":68460,\"arrival_time\":120660},{\"vehicleID\":\"4747660\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":64800,\"arrival_time\":122400},{\"vehicleID\":\"4763603\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":68400,\"arrival_time\":122400},{\"vehicleID\":\"4747663\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":122400},{\"vehicleID\":\"4763679\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":241,\"dept_time\":72000,\"arrival_time\":122400},{\"vehicleID\":\"4224309\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":72000,\"arrival_time\":122400},{\"vehicleID\":\"4227682\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":75600,\"arrival_time\":122400},{\"vehicleID\":\"4742245\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":68400,\"arrival_time\":126000},{\"vehicleID\":\"4742254\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2155,\"dept_time\":72000,\"arrival_time\":126000},{\"vehicleID\":\"4647847\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":66660,\"arrival_time\":126060},{\"vehicleID\":\"4245602\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":360,\"dept_time\":61200,\"arrival_time\":126900},{\"vehicleID\":\"4245802\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":360,\"dept_time\":61200,\"arrival_time\":126900},{\"vehicleID\":\"4224314\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":68400,\"arrival_time\":127200},{\"vehicleID\":\"4224910\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":72000,\"arrival_time\":127200},{\"vehicleID\":\"4476084\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":68400,\"arrival_time\":129600},{\"vehicleID\":\"4538197\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2192,\"dept_time\":72000,\"arrival_time\":129600},{\"vehicleID\":\"4646780\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":360,\"dept_time\":54060,\"arrival_time\":130560},{\"vehicleID\":\"4781865\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2143,\"dept_time\":63000,\"arrival_time\":132300},{\"vehicleID\":\"4536605\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2251,\"dept_time\":71100,\"arrival_time\":135000},{\"vehicleID\":\"4550222\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2251,\"dept_time\":71400,\"arrival_time\":135000},{\"vehicleID\":\"4245594\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2219,\"dept_time\":61200,\"arrival_time\":138600},{\"vehicleID\":\"4245792\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2219,\"dept_time\":61200,\"arrival_time\":138600},{\"vehicleID\":\"4770395\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2145,\"dept_time\":70200,\"arrival_time\":140400},{\"vehicleID\":\"4536142\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2143,\"dept_time\":71100,\"arrival_time\":142200},{\"vehicleID\":\"4528761\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2143,\"dept_time\":71400,\"arrival_time\":142200},{\"vehicleID\":\"4245593\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2137,\"dept_time\":61200,\"arrival_time\":144000},{\"vehicleID\":\"4245791\",\"src_station\":2148,\"mode_of_transport\":\"bus\",\"dst_station\":2137,\"dept_time\":61200,\"arrival_time\":144000}]"
    assert schedule2==conn|>get("/api/station/schedule?station_code=2148&date=11-2-2017")|>text_response
    assert "[]"==conn|>get("/api/station/schedule?station_code=2264&date=11-2-2017")|>text_response
    assert %{"error"=>"Invalid data"}==conn|>get("/api/station/schedule?station_code=2265&date=11-2-2017")|>json_response
    assert %{"error"=>"Invalid data"}==conn|>get("/api/station/schedule?station_code=-34&date=11-2-2017")|>json_response
    API.remove(:NC)
  end

  test "add new entry to schedule", %{conn: conn} do
    get("/api")
    assert "New Schedule added!\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID": "I5-1234_A320", "src_station": 135, "dst_station": 453, "dept_time": 12300, "arrival_time": 14000, "mode_of_transport": "flight"}}))|>post("/api/station/schedule/add")|>text_response
    assert "New Schedule added!\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID": "12367", "src_station": 523, "dst_station": 918, "dept_time": 23000, "arrival_time": 76720, "mode_of_transport": "train"}}))|>post("/api/station/schedule/add")|>text_response
    assert "New Schedule added!\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID": "1100234", "src_station": 1267, "dst_station": 412, "dept_time": 12300, "arrival_time": 94000, "mode_of_transport": "bus"}}))|>post("/api/station/schedule/add")|>text_response
    assert %{"error"=>"Invalid data"}==conn|>put_body_or_params(~s({"entry": {"vehicleID": "11034", "src_station": 4267, "dst_station": 4122, "dept_time": 27620, "arrival_time":93700, "mode_of_transport": "train"}}))|>post("/api/station/schedule/add")|>json_response
    API.remove(:NC)
  end

  test "update existing entry in schedule", %{conn: conn} do
    get("/api")
    assert "Schedule Updated!\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID":"11043", "src_station":115, "mode_of_transport":"train", "dst_station":294, "dept_time":51200, "arrival_time":64000}}))|>put("/api/station/schedule/update")|>text_response
    assert "Schedule Updated!\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID":"G8-355_A320", "src_station":928, "mode_of_transport":"flight", "dst_station":1634, "dept_time":34500, "arrival_time":46200}}))|>put("/api/station/schedule/update")|>text_response
    assert %{"error"=>"Invalid data"}==conn|>put_body_or_params(~s({"entry": {"vehicleID": "3401101", "src_station": 2378, "dst_station": 0, "dept_time": 87600, "arrival_time": 24000, "mode_of_transport": "bus"}}))|>put("/api/station/schedule/update")|>json_response
    #assert "Vehicle not found\n"==conn|>put_body_or_params(~s({"entry": {"vehicleID": "11002", "src_station": 7, "dst_station": 4, "dept_time": 12300, "arrival_time": 14000, "mode_of_transport": "flight"}}))|>put("/api/station/schedule/update")|>text_response
    API.remove(:NC)
  end

  test "returns state", %{conn: conn} do
    get("/api")
    locVars1="{\"disturbance\":\"no\",\"delay\":1.84,\"congestionDelay\":5.5200000000000005,\"congestion\":\"high\"}"
    assert locVars1==conn|>get("/api/station/state?station_code=565")|>text_response
    locVars2="{\"disturbance\":\"no\",\"delay\":0.38,\"congestionDelay\":0.76,\"congestion\":\"low\"}"
    assert locVars2==conn|>get("/api/station/state?station_code=778")|>text_response
    assert %{"error"=>"Invalid data"}==conn|>get("/api/station/state?station_code=2924")|>json_response
    API.remove(:NC)
  end

  test "updates state", %{conn: conn} do
    get("/api")
    assert "State Updated!\n"==conn|>put_body_or_params(~s({"station_code": 4, "local_vars": {"congestion": "low", "delay": 0.45, "disturbance": "yes"}}))|>put("/api/station/state/update")|>text_response
    assert "State Updated!\n"==conn|>put_body_or_params(~s({"station_code": 1632, "local_vars": {"congestion": "high", "delay": 0.27, "disturbance": "no"}}))|>put("/api/station/state/update")|>text_response
    assert %{"error"=>"Invalid data"}==conn|>put_body_or_params(~s({"station_code": 0, "local_vars": {"congestion": "high", "delay": 0.194, "disturbance": "yes"}}))|>put("/api/station/state/update")|>json_response
    API.remove(:NC)
  end

end